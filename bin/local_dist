#!/bin/bash

VERSION=$(python -c 'import liblet; print(liblet.__version__)')
rm -rf ./src/liblet/__pycache__ ./build/dist/liblet-*.zip
python -m compileall src/liblet
base="$(pwd)/build/dist/"
dest="liblet-${VERSION}.zip"
(cd src && zip -i \*.pyc -9Xr "${base}${dest}" liblet)
sed -i -e "s|/liblet.*|/$dest|" "./bin/lecture"
for p in handouts playground; do
    echo "Updating ${p}..."
    git -C "../$p" rm -f ".${p}/libs/"liblet*
    cp "${base}${dest}" "../$p/.${p}/libs/${dest}"
    sed -i -e "s|/liblet.*|/$dest|" "../$p/binder/start"
    git -C "../$p" add ".${p}/libs/$dest" "binder/start"
    git -C "../$p" commit -m"LibLet version bump to: $VERSION"
done